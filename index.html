<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Safety & Tech Share Wheel â€” FINAL FIX</title>

<style>
:root {
    --bg: #0b0f17;
    --bg2: #141b29;
    --glass: rgba(255,255,255,0.06);
    --glass-border: rgba(255,255,255,0.12);
    --text: #e9ecf2;
    --accent1: #00eaff;
    --accent2: #ff4da6;
    --accent3: #8a2eff;
    --radius: 18px;
    --shadow: 0 0 35px rgba(0,0,0,0.5);
}

body {
    margin: 0;
    background: radial-gradient(circle at top, var(--bg2), var(--bg));
    font-family: "Segoe UI", sans-serif;
    color: var(--text);
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Winner Banner */
#winnerBanner {
    margin-top: 12px;
    padding: 20px 30px;
    background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    font-size: 30px;
    font-weight: bold;
    min-height: 55px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Controls */
.controls {
    margin-top: 15px;
    display: flex;
    gap: 14px;
}
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius);
    color: white;
    cursor: pointer;
    font-size: 17px;
    background: linear-gradient(135deg, var(--accent1), var(--accent3));
}
.reset-btn {
    background: linear-gradient(135deg, #ff3b3b, #ff0066);
}

/* Pointer */
#pointer {
    width: 0;
    height: 0;
    border-left: 28px solid transparent;
    border-right: 28px solid transparent;
    border-bottom: 45px solid var(--accent2);
    margin: 10px auto;
}

/* Wheel */
#wheel {
    width: 460px;
    height: 460px;
    border-radius: 50%;
    border: 6px solid rgba(255,255,255,0.2);
    background: black;
    position: relative;
    overflow: hidden;
    transition: transform 6s cubic-bezier(.14,.78,.23,1);
}

.sliceLabel {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 48%;
    transform-origin: 0% 50%;
    text-align: right;
    padding-right: 12px;
    font-size: 18px;
    font-weight: bold;
    pointer-events: none;
    color: white;
}

/* Panels */
.sidePanelContainer {
    position: absolute;
    top: 95px;
    width: 95%;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
}
.panel {
    width: 200px;
    height: 340px;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(16px);
    border-radius: var(--radius);
    padding: 12px;
    overflow-y: auto;
}
.listItem {
    padding: 8px;
    margin-bottom: 6px;
    background: rgba(255,255,255,0.08);
    border-radius: var(--radius);
}

/* Confetti */
.confetti {
    position: fixed;
    width: 12px;
    height: 12px;
    top: -10px;
    animation: fall 3s linear forwards;
}
@keyframes fall {
    to { transform: translateY(110vh) rotate(720deg); }
}
</style>
</head>

<body>

<div id="winnerBanner">Spin the Wheel!</div>

<div class="controls">
    <button class="btn" onclick="spin('safety')">Spin Safety</button>
    <button class="btn" onclick="spin('tech')">Spin Tech</button>
    <button class="btn reset-btn" onclick="resetAll()">Reset</button>
</div>

<div id="pointer"></div>
<div id="wheel"></div>

<div class="sidePanelContainer">
    <div class="panel">
        <h3>Remaining</h3>
        <div id="remainingList"></div>
    </div>
    <div class="panel">
        <h3>Selected</h3>
        <div id="chosenList"></div>
    </div>
</div>

<script>

/* --------------------- ROSTER ----------------------- */
const defaultRoster = [
  "Ali Santiago","Anna Hutchinson","Austin Bartoszek","Brian Kloppe",
  "Casey Williams","Carter Nelson","Christian A. Johnston","Christie Walters",
  "Daniel Taggart","Emiliano Garcia","Frank Bottiglieri","Grace Frigaard",
  "Greg Waters","Ian Manhoo","Jim Pesek","Julissa Vergara",
  "Kevin Ferm","Kyle Young","Mark Besser","Patrick McCarron",
  "Rey Rodriguez","Richard Fredette","Shaun Thomas","Shane Bowen",
  "Stacie Gray","Steve Lauer","Timothy Costello"
];

function loadPool(key, fallback) {
    let saved = JSON.parse(localStorage.getItem(key));
    if (!Array.isArray(saved) || saved.length === 0) {
        localStorage.setItem(key, JSON.stringify([...fallback]));
        return [...fallback];
    }
    return saved;
}

let names = loadPool("names", defaultRoster);
let safetyPool = loadPool("safetyPool", names);
let techPool = loadPool("techPool", names);
let chosenHistory = loadPool("chosenHistory", []);

/* --------------------- SAVE ----------------------- */
function saveState() {
    localStorage.setItem("names", JSON.stringify(names));
    localStorage.setItem("safetyPool", JSON.stringify(safetyPool));
    localStorage.setItem("techPool", JSON.stringify(techPool));
    localStorage.setItem("chosenHistory", JSON.stringify(chosenHistory));
}

/* --------------------- LABEL INITIALS ----------------------- */
const initials = name => name.split(" ").map(w => w[0]).join("").toUpperCase();

/* --------------------- BUILD WHEEL ----------------------- */
function buildWheel(list) {
    const wheel = document.getElementById("wheel");
    wheel.innerHTML = "";

    const sliceAngle = 360 / list.length;
    let gradientParts = [];

    for (let i = 0; i < list.length; i++) {
        const start = i * sliceAngle;
        const end = start + sliceAngle;
        const col = i % 2 === 0 ? "var(--accent1)" : "var(--accent2)";
        gradientParts.push(`${col} ${start}deg ${end}deg`);
    }

    wheel.style.background = `conic-gradient(${gradientParts.join(",")})`;

    list.forEach((name, i) => {
        const label = document.createElement("div");
        label.className = "sliceLabel";
        label.style.transform = `rotate(${i * sliceAngle}deg) translate(0, -50%)`;
        label.textContent = initials(name);
        wheel.appendChild(label);
    });
}

/* --------------------- CONFETTI ----------------------- */
function launchConfetti() {
    for (let i = 0; i < 40; i++) {
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = Math.random() * 100 + "vw";
        c.style.background = ["#ff4da6","#00eaff","#8a2eff","#ffdd00"][Math.floor(Math.random()*4)];
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 3000);
    }
}

/* --------------------- SPIN (guaranteed to work) ----------------------- */
let spinning = false;

function spin(type) {
    if (spinning) return;
    spinning = true;

    let pool = type === "safety" ? safetyPool : techPool;
    if (!pool || pool.length === 0) {
        pool = type === "safety" ? (safetyPool = [...names]) : (techPool = [...names]);
    }

    buildWheel(pool);

    const wheel = document.getElementById("wheel");
    const sliceAngle = 360 / pool.length;
    const index = Math.floor(Math.random() * pool.length);
    const winner = pool[index];

    /* --- HARD RESET (Fix for Safari/Chrome no-spin bug) --- */
    wheel.style.transition = "none";
    wheel.style.transform = "rotate(0.0001deg)";
    wheel.offsetHeight; // FORCE REPAINT

    /* --- APPLY SPIN --- */
    const landingRotation = 360 * 20 + (360 - (index * sliceAngle + sliceAngle / 2));
    wheel.style.transition = "transform 6s cubic-bezier(.14,.78,.23,1)";
    wheel.style.transform = `rotate(${landingRotation}deg)`;

    setTimeout(() => {
        spinning = false;

        pool.splice(index, 1);
        chosenHistory.unshift(winner);
        saveState();

        document.getElementById("winnerBanner").textContent = `ðŸ† Congratulations, ${winner}!`;

        updateLists();
        launchConfetti();

    }, 6100);
}

/* --------------------- UPDATE PANELS ----------------------- */
function updateLists() {
    document.getElementById("remainingList").innerHTML =
        names.map(n => `<div class='listItem'>${n}</div>`).join("");
    document.getElementById("chosenList").innerHTML =
        chosenHistory.map(n => `<div class='listItem'>âœ” ${n}</div>`).join("");
}

/* --------------------- RESET ----------------------- */
function resetAll() {
    if (!confirm("Reset ALL progress?")) return;

    localStorage.clear();
    names = [...defaultRoster];
    safetyPool = [...defaultRoster];
    techPool = [...defaultRoster];
    chosenHistory = [];
    saveState();
    updateLists();
    buildWheel(names);
    document.getElementById("winnerBanner").textContent = "Progress Reset.";
}

/* --------------------- INIT ----------------------- */
buildWheel(names);
updateLists();

</script>
</body>
</html>
