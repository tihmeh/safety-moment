<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Safety & Tech Share Wheel â€” Fixed Edition</title>

<style>
:root {
    --bg: #0b0f17;
    --bg2: #141b29;
    --glass: rgba(255,255,255,0.06);
    --glass-border: rgba(255,255,255,0.12);
    --text: #e9ecf2;
    --accent1: #00eaff;
    --accent2: #ff4da6;
    --accent3: #8a2eff;
    --radius: 18px;
    --shadow: 0 0 35px rgba(0,0,0,0.5);
}

body {
    margin: 0;
    background: radial-gradient(circle at top, var(--bg2), var(--bg));
    font-family: "Segoe UI", sans-serif;
    color: var(--text);
    overflow: hidden;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* WINNER BANNER */
#winnerBanner {
    margin-top: 12px;
    padding: 20px 30px;
    background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    font-size: 30px;
    font-weight: 700;
    min-height: 55px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    letter-spacing: 1.5px;
}

/* BUTTONS */
.controls {
    margin-top: 15px;
    display: flex;
    gap: 14px;
}

.btn {
    padding: 12px 24px;
    background: linear-gradient(135deg, var(--accent1), var(--accent3));
    border: none;
    border-radius: var(--radius);
    color: var(--text);
    cursor: pointer;
    font-size: 17px;
    letter-spacing: 0.7px;
    transition: all 0.25s ease;
    box-shadow: 0 0 12px rgba(0,0,0,0.3);
}

.btn:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: 0 0 22px var(--accent1);
}

.reset-btn {
    background: linear-gradient(135deg, #ff3b3b, #ff0066);
}

.reset-btn:hover {
    box-shadow: 0 0 22px #ff3b3b;
}

/* POINTER */
#pointer {
    width: 0;
    height: 0;
    border-left: 28px solid transparent;
    border-right: 28px solid transparent;
    border-bottom: 45px solid var(--accent2);
    margin: 0 auto 5px;
    animation: pulse 1s infinite alternate ease-in-out;
    filter: drop-shadow(0 0 10px var(--accent2));
}
@keyframes pulse {
    from { transform: translateY(0); }
    to { transform: translateY(-6px); }
}

/* WHEEL */
#wheel {
    width: 460px;
    height: 460px;
    border-radius: 50%;
    position: relative;
    border: 6px solid rgba(255,255,255,0.15);
    overflow: hidden;
    box-shadow: var(--shadow);
    background: black;
    transition: transform 6s cubic-bezier(.14,.78,.23,1);
}

.sliceLabel {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 48%;
    transform-origin: 0% 50%;
    text-align: right;
    padding-right: 14px;
    font-size: 18px;
    font-weight: bold;
    pointer-events: none;
    color: white;
    text-shadow: 0 0 8px black;
}

/* PANELS */
.sidePanelContainer {
    position: absolute;
    top: 95px;
    width: 95%;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
}

.panel {
    width: 200px;
    height: 340px;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(16px);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 12px;
    overflow-y: auto;
    font-size: 15px;
}

.listItem {
    padding: 8px;
    margin-bottom: 6px;
    background: rgba(255,255,255,0.08);
    border-radius: var(--radius);
}

/* CONFETTI */
.confetti {
    position: fixed;
    width: 12px;
    height: 12px;
    top: -10px;
    opacity: 0.9;
    animation: fall 2.5s linear forwards;
}
@keyframes fall {
    to { transform: translateY(110vh) rotate(720deg); }
}

</style>
</head>

<body>

<div id="winnerBanner">Spin the Wheel!</div>

<!-- BUTTONS -->
<div class="controls">
    <button class="btn" onclick="spin('safety')">Spin Safety</button>
    <button class="btn" onclick="spin('tech')">Spin Tech</button>
    <button class="btn reset-btn" onclick="resetAll()">Reset</button>
</div>

<!-- WHEEL -->
<div>
    <div id="pointer"></div>
    <div id="wheel"></div>
</div>

<!-- PANELS -->
<div class="sidePanelContainer">
    <div class="panel">
        <h3>Remaining</h3>
        <div id="remainingList"></div>
    </div>
    <div class="panel">
        <h3>Selected</h3>
        <div id="chosenList"></div>
    </div>
</div>

<script>

/* ---------------------------------------------
   DEFAULT TEAM LIST
--------------------------------------------- */
const defaultRoster = [
  "Ali Santiago","Anna Hutchinson","Austin Bartoszek","Brian Kloppe",
  "Casey Williams","Carter Nelson","Christian A. Johnston","Christie Walters",
  "Daniel Taggart","Emiliano Garcia","Frank Bottiglieri","Grace Frigaard",
  "Greg Waters","Ian Manhoo","Jim Pesek","Julissa Vergara",
  "Kevin Ferm","Kyle Young","Mark Besser","Patrick McCarron",
  "Rey Rodriguez","Richard Fredette","Shaun Thomas","Shane Bowen",
  "Stacie Gray","Steve Lauer","Timothy Costello"
];

/* -------- SAFE LOADER (fixes corrupted or empty storage) -------- */
function loadPool(key, fallback) {
    let saved = JSON.parse(localStorage.getItem(key));
    if (!Array.isArray(saved) || saved.length === 0) {
        localStorage.setItem(key, JSON.stringify([...fallback]));
        return [...fallback];
    }
    return saved;
}

let names = loadPool("names", defaultRoster);
let safetyPool = loadPool("safetyPool", names);
let techPool = loadPool("techPool", names);
let chosenHistory = loadPool("chosenHistory", []);

/* SAVE STATE */
function saveState() {
    localStorage.setItem("names", JSON.stringify(names));
    localStorage.setItem("safetyPool", JSON.stringify(safetyPool));
    localStorage.setItem("techPool", JSON.stringify(techPool));
    localStorage.setItem("chosenHistory", JSON.stringify(chosenHistory));
}

/* ---------------------------------------------
   GET INITIALS
--------------------------------------------- */
const initials = name => name.split(" ").map(w => w[0]).join("").toUpperCase();

/* ---------------------------------------------
   BUILD WHEEL (dynamic slices)
--------------------------------------------- */
function buildWheel(list) {
    const wheel = document.getElementById("wheel");
    wheel.innerHTML = "";
    const sliceAngle = 360 / list.length;

    let gradient = [];
    for (let i = 0; i < list.length; i++) {
        const start = i * sliceAngle;
        const end = start + sliceAngle;
        const col = i % 2 === 0 ? "var(--accent1)" : "var(--accent2)";
        gradient.push(`${col} ${start}deg ${end}deg`);
    }

    wheel.style.background = `conic-gradient(${gradient.join(",")})`;

    list.forEach((name, i) => {
        const label = document.createElement("div");
        label.className = "sliceLabel";
        label.style.transform = `rotate(${i * sliceAngle}deg) translate(0,-50%)`;
        label.textContent = initials(name);
        wheel.appendChild(label);
    });
}

/* ---------------------------------------------
   CONFETTI
--------------------------------------------- */
function launchConfetti() {
    for (let i = 0; i < 50; i++) {
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = Math.random() * 100 + "vw";
        c.style.background = ["#ff4da6","#00eaff","#8a2eff","#ffdd00"][Math.floor(Math.random()*4)];
        c.style.animationDuration = (1.5 + Math.random()*2) + "s";
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 3000);
    }
}

/* ---------------------------------------------
   SPIN FUNCTION â€” **UNBREAKABLE VERSION**
--------------------------------------------- */
let spinning = false;

function spin(type) {
    if (spinning) return;
    spinning = true;

    let pool = type === "safety" ? safetyPool : techPool;
    if (pool.length === 0) pool = type === "safety" ? (safetyPool = [...names]) : (techPool = [...names]);

    buildWheel(pool);

    const wheel = document.getElementById("wheel");
    const sliceAngle = 360 / pool.length;
    const index = Math.floor(Math.random() * pool.length);
    const winner = pool[index];

    /* --- This patch guarantees spin ALWAYS works --- */

    wheel.style.transition = "none";
    wheel.style.transform = "rotate(0deg)";
    void wheel.offsetWidth; // force layout

    requestAnimationFrame(() => {
        wheel.style.transition = "transform 6s cubic-bezier(.14,.78,.23,1)";
        const landing = 360 * 15 + (360 - (index * sliceAngle + sliceAngle / 2));
        wheel.style.transform = `rotate(${landing}deg)`;
    });

    /* AFTER SPIN */
    setTimeout(() => {
        spinning = false;

        pool.splice(index, 1);
        chosenHistory.unshift(winner);
        saveState();

        document.getElementById("winnerBanner").textContent =
            `ðŸ† Congratulations, ${winner}!`;

        updateLists();
        launchConfetti();

    }, 6050);
}

/* ---------------------------------------------
   UPDATE LIST PANELS
--------------------------------------------- */
function updateLists() {
    document.getElementById("remainingList").innerHTML =
        names.map(n => `<div class='listItem'>${n}</div>`).join("");

    document.getElementById("chosenList").innerHTML =
        chosenHistory.map(n => `<div class='listItem'>âœ” ${n}</div>`).join("");
}

/* ---------------------------------------------
   RESET FUNCTION
--------------------------------------------- */
function resetAll() {
    if (!confirm("Reset ALL progress?")) return;

    localStorage.clear();
    names = [...defaultRoster];
    safetyPool = [...defaultRoster];
    techPool = [...defaultRoster];
    chosenHistory = [];

    saveState();
    buildWheel(names);
    updateLists();
    document.getElementById("winnerBanner").innerText = "Progress Reset.";
}

/* ---------------------------------------------
   INIT
--------------------------------------------- */
buildWheel(names);
updateLists();

</script>
</body>
</html>

