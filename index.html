<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Safety & Tech Share Wheel</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
    text-align: center;
    margin: 0;
    padding: 20px;
}

#winnerBanner {
    font-size: 24px;
    margin: 20px;
    padding: 15px;
    background: #333;
    border-radius: 10px;
}

button {
    padding: 12px 20px;
    margin: 10px;
    background: #007bff;
    border: none;
    border-radius: 6px;
    color: white;
    cursor: pointer;
}
button:hover {
    background: #0056b3;
}

#pointer {
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 30px solid red;
    margin: 10px auto;
}

#wheel {
    width: 350px;
    height: 350px;
    border-radius: 50%;
    border: 6px solid #444;
    margin: 20px auto;
    position: relative;
    overflow: hidden;
    transition: transform 5s cubic-bezier(.17,.67,.12,1.02);
    background: #222;
}

.sliceLabel {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 40%;
    transform-origin: 0% 50%;
    color: white;
    text-align: right;
    font-size: 18px;
    pointer-events: none;
}

.panel {
    width: 250px;
    margin: 20px auto;
    padding: 15px;
    background: #222;
    border-radius: 10px;
}
.listItem { padding: 6px; }
</style>
</head>

<body>

<h1>Safety & Tech Share Wheel</h1>

<div id="winnerBanner">Spin the wheel!</div>

<button onclick="spin('safety')">Spin Safety</button>
<button onclick="spin('tech')">Spin Tech</button>
<button onclick="resetAll()" style="background:#ff4444;">Reset</button>

<div id="pointer"></div>
<div id="wheel"></div>

<div class="panel">
    <h3>Remaining People</h3>
    <div id="remainingList"></div>
</div>

<div class="panel">
    <h3>Chosen</h3>
    <div id="chosenList"></div>
</div>

<script>
/* ------------ DATA ---------------- */
const defaultRoster = [
  "Ali Santiago","Anna Hutchinson","Austin Bartoszek","Brian Kloppe",
  "Casey Williams","Carter Nelson","Christian A. Johnston","Christie Walters",
  "Daniel Taggart","Emiliano Garcia","Frank Bottiglieri","Grace Frigaard",
  "Greg Waters","Ian Manhoo","Jim Pesek","Julissa Vergara",
  "Kevin Ferm","Kyle Young","Mark Besser","Patrick McCarron",
  "Rey Rodriguez","Richard Fredette","Shaun Thomas","Shane Bowen",
  "Stacie Gray","Steve Lauer","Timothy Costello"
];

function load(key, fallback) {
    let x = JSON.parse(localStorage.getItem(key));
    return Array.isArray(x) && x.length ? x : [...fallback];
}

let names = load("names", defaultRoster);
let safetyPool = load("safetyPool", names);
let techPool = load("techPool", names);
let chosenHistory = load("chosenHistory", []);

function save() {
    localStorage.setItem("names", JSON.stringify(names));
    localStorage.setItem("safetyPool", JSON.stringify(safetyPool));
    localStorage.setItem("techPool", JSON.stringify(techPool));
    localStorage.setItem("chosenHistory", JSON.stringify(chosenHistory));
}

/* ------------ WHEEL BUILD ---------------- */
function initials(name) {
    return name.split(" ").map(x => x[0]).join("").toUpperCase();
}

function buildWheel(pool) {
    const wheel = document.getElementById("wheel");
    wheel.innerHTML = "";
    const angle = 360 / pool.length;

    for (let i = 0; i < pool.length; i++) {
        const div = document.createElement("div");
        div.className = "sliceLabel";
        div.textContent = initials(pool[i]);
        div.style.transform = `rotate(${angle * i}deg) translate(0, -50%)`;
        wheel.appendChild(div);
    }
}

/* ------------ SPIN (WORKING) ---------------- */
let spinning = false;

function spin(type) {
    if (spinning) return;
    spinning = true;

    let pool = type === "safety" ? safetyPool : techPool;
    if (pool.length === 0) pool = type === "safety" ? (safetyPool=[...names]) : (techPool=[...names]);

    buildWheel(pool);

    const wheel = document.getElementById("wheel");
    const angle = 360 / pool.length;
    const index = Math.floor(Math.random() * pool.length);
    const winner = pool[index];

    // RESET FIRST so animation always triggers
    wheel.style.transition = "none";
    wheel.style.transform = "rotate(0deg)";
    wheel.offsetHeight; // force reflow

    // THEN apply spin
    const finalAngle = 360 * 10 + (360 - (index * angle + angle / 2));
    wheel.style.transition = "transform 5s cubic-bezier(.17,.67,.12,1.02)";
    wheel.style.transform = `rotate(${finalAngle}deg)`;

    setTimeout(() => {
        spinning = false;
        pool.splice(index, 1);
        chosenHistory.unshift(winner);
        save();
        document.getElementById("winnerBanner").textContent =
            "ðŸ† Congratulations, " + winner + "!";
        updateLists();
    }, 5100);
}

/* ------------ UI UPDATES ---------------- */
function updateLists() {
    document.getElementById("remainingList").innerHTML =
        names.map(n => `<div class='listItem'>${n}</div>`).join("");

    document.getElementById("chosenList").innerHTML =
        chosenHistory.map(n => `<div class='listItem'>âœ” ${n}</div>`).join("");
}

/* ------------ RESET ---------------- */
function resetAll() {
    if (!confirm("Reset all progress?")) return;
    localStorage.clear();
    names = [...defaultRoster];
    safetyPool = [...defaultRoster];
    techPool = [...defaultRoster];
    chosenHistory = [];
    save();
    buildWheel(names);
    updateLists();
}

/* ------------ INIT ---------------- */
buildWheel(names);
updateLists();

</script>

</body>
</html>
